#01_03_end

##Preparing for Relay

As I mentioned earlier, we’re going to be using Facebook’s Relay library to handle the bulk of our applications data fetching and storing needs.

Relay is a really awesome framework that pairs well with React and allows us to ensure that our views are correctly and efficiently retrieving new information, updating existing information, and handling new user requests.

![](/slides/01_03.001.jpeg)

If you’re not familiar with Relay –– that’s ok! Don’t be intimidated. I’m going to explain a number of its features as we employ them into our site –– and I’ll also provide you with some additional resources if you want to learn more.  

For Relay to run properly our App needs to have access to our API’s Relay Schema. The Relay Schema is a document which gets generated by our API and that informs our application about the kinds of models, data types, queries, and mutations that will be available to our application.

We could create our own Relay enabled API with Node –– but it is going to be a whole lot faster to use Graph.Cool’s Relay API creation tools.

If you don’t have an account with Graph.Cool, go ahead and create one now. Then, login, and create a new project –– I’m going to call mine TicTacTuring.

Now that I have my project I can see here, down at the bottom, that Graph.Cool has automatically generated a URL for my Relay API. We’re going to need that in a second...

![](/slides/01_03.003.jpeg)

But first we’re going to need to make sure our application is configured to automatically fetch our API’s most up to date schema.

In order to do this we need to Eject our create-react-app so that we can access its webpack configuration files.

In the command line we are going to execute

```bash
yarn run eject
```

The terminal will give us a scary are you sure prompt but we say yes.

and once its finished we see that our project folder now contains these two new directories, `config` and `scripts`. Essentially we’ve exposed all of the configuration, startup, and build scripts that were previously happening beneath the surface.

Next lets add a babel plugin to our dev dependencies which will automatically take care of our relay schema fetching needs.
![](/slides/01_03.004.jpeg)


```bash
yarn add -D babel-plugin-react-relay
```

In order to get it working correctly though we need to make one small change to our Webpack configurations.

![](/slides/01_03.002.jpeg)

Search for ‘cacheDirectory’ and change this setting to false –– cacheing can speed up your app’s development build process but it will cause problems for us when we need to ensure that our application is working off the most current Relay schema.


```javascript
/*    /config/webpack.config.dev.js   */

    //...

        cacheDirectory: false
      }
    },

    //...

```

I’m also going to make a small change to the start script. I’m going to get rid of all the instances of clearConsole() and openBrowser()–– because sometimes I like to be able to read output that would otherwise get cleared by default and I don’t like the way the app automatically opens up a new window.

Next we will open up our package.json and make a change to our babel configuration settings by adding:

`"plugins": ["react-relay"],` to the babel settings.

```json
## package.json
},
  ...
  "babel": {
    "plugins": ["react-relay"],
    "presets": [
      "react-app"
    ]
  },
  ...
```

The final step to get things working will be to declare an environment variable in our start and build commands.

This is where we make use of that api url Graph.Cool generated for us.

//add GRAPHQL_ENDPOINT=https://YOUR_URL_HERE

```json
//...
  "scripts": {
    "start": "GRAPHQL_ENDPOINT=https://YOUR_GRAPHCOOL_RELAY_API_URL node scripts/start.js",
    "build": "GRAPHQL_ENDPOINT=https://YOUR_GRAPHCOOL_RELAY_API_URL node scripts/build.js",
    "test": "node scripts/test.js --env=jsdom"
  },
//...
```

Now when I restart my application I can see that my app is fetching my api’s relay schema.

Great. I'm also going to make a config directory under src and create a urls file there where I can store configuration information like this in case I need it later on for something.

```javascript
/*    /src/config/urls.js   */
export const relayApiUrl = 'https://api.graph.cool/relay/v1/cixqegi9u003g0196b2rtnhqu'
```
